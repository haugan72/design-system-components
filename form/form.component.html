<form
  class="app-form"
  [class.form-vertical]="config().layout === 'vertical'"
  [class.form-horizontal]="config().layout === 'horizontal'"
  [class.form-inline]="config().layout === 'inline'"
  (submit)="onSubmit($event)"
  novalidate>

  <!-- Form Header -->
  @if (title() || description()) {
    <div class="form-header">
      @if (title()) {
        <h3 class="form-title">{{ title() }}</h3>
      }
      @if (description()) {
        <p class="form-description">{{ description() }}</p>
      }
    </div>
  }

  <!-- Form Fields -->
  <div class="form-fields">
    @for (field of fields(); track field.name) {
      <div
        class="form-field"
        [class.has-error]="shouldShowError(field)"
        [class.is-required]="field.required || field.validation?.required">

        <!-- Field Label -->
        <label
          class="form-label"
          [attr.for]="field.name">
          {{ field.label }}
          @if (field.required || field.validation?.required) {
            <span class="required-marker" aria-label="required">*</span>
          }
        </label>

        <!-- Field Input -->
        <div class="form-control-wrapper">

          <!-- Text Inputs -->
          @if (field.type === 'text' || field.type === 'email' || field.type === 'password' || field.type === 'tel' || field.type === 'url' || field.type === 'date') {
            <input
              class="form-control"
              [type]="field.type"
              [id]="field.name"
              [name]="field.name"
              [placeholder]="field.placeholder || ''"
              [disabled]="field.disabled || loading()"
              [value]="getFieldValue(field)"
              (input)="onFieldChange(field, $any($event.target).value)"
              (blur)="onFieldBlur(field)"
              [attr.aria-invalid]="shouldShowError(field)"
              [attr.aria-describedby]="shouldShowError(field) ? field.name + '-error' : field.helpText ? field.name + '-help' : null">
          }

          <!-- Number Input -->
          @else if (field.type === 'number') {
            <input
              class="form-control"
              type="number"
              [id]="field.name"
              [name]="field.name"
              [placeholder]="field.placeholder || ''"
              [disabled]="field.disabled || loading()"
              [value]="getFieldValue(field)"
              [min]="field.validation?.min"
              [max]="field.validation?.max"
              (input)="onFieldChange(field, $any($event.target).valueAsNumber)"
              (blur)="onFieldBlur(field)"
              [attr.aria-invalid]="shouldShowError(field)"
              [attr.aria-describedby]="shouldShowError(field) ? field.name + '-error' : field.helpText ? field.name + '-help' : null">
          }

          <!-- Textarea -->
          @else if (field.type === 'textarea') {
            <textarea
              class="form-control form-textarea"
              [id]="field.name"
              [name]="field.name"
              [placeholder]="field.placeholder || ''"
              [disabled]="field.disabled || loading()"
              [rows]="field.rows || 4"
              [value]="getFieldValue(field)"
              (input)="onFieldChange(field, $any($event.target).value)"
              (blur)="onFieldBlur(field)"
              [attr.aria-invalid]="shouldShowError(field)"
              [attr.aria-describedby]="shouldShowError(field) ? field.name + '-error' : field.helpText ? field.name + '-help' : null"></textarea>
          }

          <!-- Select -->
          @else if (field.type === 'select') {
            <select
              class="form-control form-select"
              [id]="field.name"
              [name]="field.name"
              [disabled]="field.disabled || loading()"
              [value]="getFieldValue(field)"
              (change)="onFieldChange(field, $any($event.target).value)"
              (blur)="onFieldBlur(field)"
              [attr.aria-invalid]="shouldShowError(field)"
              [attr.aria-describedby]="shouldShowError(field) ? field.name + '-error' : field.helpText ? field.name + '-help' : null">
              <option value="">{{ field.placeholder || 'Select an option' }}</option>
              @for (option of field.options || []; track option.value) {
                <option [value]="option.value">{{ option.label }}</option>
              }
            </select>
          }

          <!-- Checkbox -->
          @else if (field.type === 'checkbox') {
            <div class="form-checkbox-wrapper">
              <input
                class="form-checkbox"
                type="checkbox"
                [id]="field.name"
                [name]="field.name"
                [disabled]="field.disabled || loading()"
                [checked]="getFieldValue(field)"
                (change)="onFieldChange(field, $any($event.target).checked)"
                (blur)="onFieldBlur(field)"
                [attr.aria-invalid]="shouldShowError(field)"
                [attr.aria-describedby]="shouldShowError(field) ? field.name + '-error' : field.helpText ? field.name + '-help' : null">
              <label class="form-checkbox-label" [attr.for]="field.name">
                {{ field.placeholder || field.label }}
              </label>
            </div>
          }

          <!-- Radio -->
          @else if (field.type === 'radio') {
            <div class="form-radio-group">
              @for (option of field.options || []; track option.value) {
                <div class="form-radio-wrapper">
                  <input
                    class="form-radio"
                    type="radio"
                    [id]="field.name + '-' + option.value"
                    [name]="field.name"
                    [value]="option.value"
                    [disabled]="field.disabled || loading()"
                    [checked]="getFieldValue(field) === option.value"
                    (change)="onFieldChange(field, option.value)"
                    (blur)="onFieldBlur(field)"
                    [attr.aria-invalid]="shouldShowError(field)"
                    [attr.aria-describedby]="shouldShowError(field) ? field.name + '-error' : field.helpText ? field.name + '-help' : null">
                  <label class="form-radio-label" [attr.for]="field.name + '-' + option.value">
                    {{ option.label }}
                  </label>
                </div>
              }
            </div>
          }

        </div>

        <!-- Help Text -->
        @if (field.helpText && !shouldShowError(field)) {
          <p class="form-help-text" [id]="field.name + '-help'">
            {{ field.helpText }}
          </p>
        }

        <!-- Error Message -->
        @if (shouldShowError(field)) {
          <p class="form-error" [id]="field.name + '-error'" role="alert">
            {{ getError(field) }}
          </p>
        }

      </div>
    }
  </div>

  <!-- Form Actions -->
  <div class="form-actions">
    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="loading()">
      @if (loading()) {
        <span class="btn-spinner"></span>
      }
      {{ config().submitLabel }}
    </button>

    @if (config().showReset) {
      <button
        type="button"
        class="btn btn-secondary"
        [disabled]="loading()"
        (click)="onReset()">
        {{ config().resetLabel }}
      </button>
    }

    @if (config().showCancel) {
      <button
        type="button"
        class="btn btn-ghost"
        [disabled]="loading()"
        (click)="onCancel()">
        {{ config().cancelLabel }}
      </button>
    }
  </div>

</form>
