<div class="kanban-board" role="region" aria-label="Kanban board">
  @for (column of columns(); track trackColumn($index, column)) {
    <app-kanban-column
      [columnId]="column.id"
      [title]="column.title"
      [icon]="column.icon"
      [count]="getColumnCount(column.id)"
      [headerColor]="column.color"
      (itemDropped)="onItemDropped($event)">

      @for (item of getColumnItems(column.id); track trackItem($index, item)) {
        <!-- Custom template or default card -->
        @if (cardTemplate) {
          <ng-container
            [ngTemplateOutlet]="cardTemplate"
            [ngTemplateOutletContext]="{ $implicit: item, column: column }">
          </ng-container>
        } @else {
          <app-kanban-card
            [title]="getCardTitle(item)"
            [subtitle]="getCardSubtitle(item)"
            [description]="getCardDescription(item)"
            [progress]="getCardProgress(item)"
            [badge]="getCardBadge(item)"
            [data]="item"
            (cardClick)="onCardClick($event)"
            (dragStarted)="onCardDragStart($event, column.id)"
            (dragEnded)="onCardDragEnd()">
          </app-kanban-card>
        }
      }

      <!-- Empty state -->
      <div empty-state>{{ emptyMessage() }}</div>
    </app-kanban-column>
  }
</div>
